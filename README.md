# SHOPPING LIST REST API

- This application enables crating, modifying and generating summary of shopping lists.
- The entire application is dockerized and can be run with docker-compose.
- It uses the official MongoDB docker image.
- NodeJS image is build with NodeJS official image as it's base image.
- It uses NodeJS, MongoDB database and JWS for authentication.
- When run with docker-compose port 8000 on localhost is exposed for http requests.
- User can log in with email and password.
- Shopping lists can be created with or without products.
- List can be modified later and products can be added or list renamed.
- A summary of all product amount in all lists can be generated by the user.

- IMPORTANT: To test the api more easily POSTMAN collection is available.
- IMPORTANT: JWT_TTL_SECONDS env variable in docker-compose is set to 60s for testing purposes.

## Pre-requirements

- Docker - tested with version 18.09.2
- Docker Compose - tested with version 1.20.1

## Run the app

    docker-compose up --build -d

## Run the tests

    sudo docker-compose -f docker-compose.test.yml up --build --abort-on-container-exit 

## Docker Compose Node APP ENV Variables

| Variable  | Description | Type | Default
| -----  | -----  | ----- | -----
| MONGODB_URI | MongoDB connection URI compatible with Mongoose. | string | -
| MONGODB_DATABASE | MongoDB database. | string | nodejs
| WAIT_HOSTS | Since NodeJS app doesn't wait for MongoDB to start, wait.sh script is configured to run and wait for MongoDB to be ready. | string | -
| JWT_TTL_SECONDS | JWT expire time. IMPORTANT: Set to 60s for testing purposes in docker-compose file. | integer |1800

## API Requests

| Action  | Request 
| -----  | -----  
| Register | POST /register
| Login | POST /login
| Change password  | POST /resetPassword
| Create Shopping lis | POST /shoppingList
| Change Shopping list | PUT /shoppingList
| Delete Shopping list | DELETE /shoppingList 
| View Shopping list | GET /shoppingLists
| Get Product report | GET /report

## Authentication

- Registered user is provided with JWT token when logs in.
- Token send in every request in request header with 'token' as key.
- When requests are sent from browser token is automatically attached to a cookie.

# REST API

The REST API routes are described bellow.

## Register

### Request

`POST /register`

    curl -d '{"email":"user_01@gmail.com", "password":"xyz1234"}' -H "Content-Type: application/json" -X POST http://localhost:8000/register

### Body

    {
        "email": "user_01",
        "password": "xyz"
    }

### Valid Response

    {
        "message": "Registration successful please log in."
    }

### Validation Error Response Example

    {
        "message": "Validation error.",
        "errors": [
            {
                "field": "email",
                "value": "test2@gmail.com",
                "err_msg": "User already exists."
            }
        ]
    }

## Login

### Request

`POST /login`

    curl -d '{"email":"user_01@gmail.com", "password":"xyz1234"}' -H "Content-Type: application/json" -X POST http://localhost:8000/login

### Body

    {
        "email": "user_01",
        "password": "xyz"
    }

### Valid Response

{
    "message": "Login successful.",
    "token": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI1ZTlkZjUxMGUzNzZjYTAwMWIxODMwMjMiLCJlbWFpbCI6InRlc3RAZ21haWwuY29tIiwiaWF0IjoxNTg3NDQ3NTgwLCJleHAiOjE1ODc0NDc2NDAsImlzcyI6IlNob3BwaW5nIExpc3QgQVBJIn0.JeBDQAAan11___t-UcEdUVMDLe6p_Yp7zP49USZV80nFqv7xvB5xrPA1BCFRmvNosqlQxgafLdH10b_gKYbLSCKovBLPSlIJMhximPjU-9HiJUCiXd8WRh9-mM9xuWO0UpUZJhXnnTeD0hFT3hU6N2q-6sHvbT1zwcbsELTDOaAZM3IMV0zAvLhcw4RDjX1lDrXGV3sUQLGZLCawHqP5qWCqu3X0maqc1eFMVPoGkqabsBus2IK_Yh7tIh9pWcTUmZIj6rxI4xAobI5pWdhQEYCrN8kM-i4FNfO_jEEdvA3cXbazzDskaSQJrhlzygMs22UE3WbEl0tQ_ckLnTF4qWpND-NrEgEPVyZtpKQffCp6O490bVRDzDHZNDyNTJqJzE-sTOxHjSW3qmd4c_yldVRnfu6oN6LhpgEAzn5arB4IRy8B7my1yg_huHFK-_cdJSMuCTDWFckElppSE4U7DVesELgSlxiuGfb-AohV0swwNHPRUneKtU8SLVVCaDML8W1-1MHBJx6pCtPY2XsiPUiP5kJxn-m_cjxpMDHviWOpgBIF_o4OP0-zoz-nqfPrf-IgGkkCK3jjN9-_JM8ibyXh-m3t1c4hJ9a3_kMdpQt7kDFQX1WYub25dR9Hphk5_Nj0KOzg3IZIJBHpV-0LZWn_SUM9duYMfmF3a6JQbIY"
}

### Incorrect password Error Response

{
    "message": "Authentication failed. Incorrect password."
}

### Validation Error Response Example

    {
        "message": "Validation error.",
        "errors": [
            {
                "field": "email",
                "err_msg": "Required field missing."
            }
        ]
    }

## Reset Password

### Request

`POST /resetPassword`

    curl -d '{"currentPassword":"xyz", "newPassword":"xyz123"}' -H "Content-Type: application/json" -X POST http://localhost:8000/resetPassword

### Body

    {
        "currentPassword": "xyz",
        "newPassword": "xyz123"
    }

### Valid Response

    {
        "message": "Password changed."
    }

### Not Authenticated Error Response

    {
        "message": "Forbidden. Not authorized."
    }

### Incorrect Current Password Error Response

    {
        "message": "Current password is not correct."
    }

### Missing Body Parameters Error Response

    {
        "message": "Body parameter missing: 'currentPassword'."
    }


## Create a Shopping list

### Request

`POST /shoppingList`

    curl -d '{"name":"list_01","products":[{"name":"product_01","amount":10},{"name":"product_02","amount":20}]}' -H "Content-Type: application/json" -X POST http://localhost:8000/shoppingList

### Body

    {
        "name": "list_01",
        "products": [
            {"name" : "product_01", "amount": 10}, 
            {"name" : "product_02", "amount": 20}
        ]
    }

### Valid Response

    {
        "message": "Shopping list created"
    }

### Not Authenticated Error Response

    {
        "message": "Forbidden. Not authorized."
    }

### Validation Error Response Example

    {
        "message": "Validation error.",
        "errors": [
            {
                "field": "name",
                "value": "list_02",
                "err_msg": "Shopping list already exists."
            }
        ]
    }


## Get Shopping lists

### Request

`GET /shoppingLists`

    curl -X GET http://localhost:8000/shoppingLists

### Valid Response

    [
        {
            "date": "2020-04-19T10:48:35.624Z",
            "_id": "5e9c2f91356cce60cbc9572c",
            "name": "list_01",
            "user_id": "5e9b5fc927702e58b5800683",
            "products": [
                {
                    "_id": "5e9c2f91356cce60cbc9572d",
                    "name": "product_01",
                    "amount": 10
                },
                {
                    "_id": "5e9c2f91356cce60cbc9572e",
                    "name": "product_02",
                    "amount": 20
                }
            ]
        }
    ]

### Not Authenticated Error Response

    {
        "message": "Forbidden. Not authorized."
    }

## Update a Shopping list

### Request

`PUT /shoppingList`

    curl -d '{"name":"list_01","newName":"list_02","products":[{"name":"product_01","amount":100},{"name":"product_02","amount":200}]}' -H "Content-Type: application/json" -X PUT http://localhost:8000/shoppingList

### Body

    {
        "name": "list_01",
        "newName": "list_02",
        "products": [
            {"name" : "product_01", "amount": 100}, 
            {"name" : "product_02", "amount": 200}
        ]
    }

### Valid Response

    {
        "message": "Shopping list updated"
    }

### Not Authenticated Error Response

    {
        "message": "Forbidden. Not authorized."
    }

### Shopping List Not Found Error Response

    {
        "message": "Shopping list not found."
    }

### Validation Error Response Example

    {
        "message": "Validation error.",
        "errors": [
            {
                "field": "name",
                "value": "list_02",
                "err_msg": "Shopping list already exists."
            }
        ]
    }


## Delete a Shopping list

### Request

`DELETE /shoppingList`

    curl -d '{"name":"list_02"}' -H "Content-Type: application/json" -X DELETE http://localhost:8000/shoppingList

### Body

    {
        "name": "list_02"
    }

### Valid Response

    {
        "message": "Shopping list deleted."
    }

### Not Authenticated Error Response

    {
        "message": "Forbidden. Not authorized.."
    }

### Shopping List Not Found Error Response

    {
        "message": "Shopping list not found."
    }

## Get Product Amount Report

### Request

`GET /report?from={datetime}&to={datetime}`

    curl -X GET http://localhost:8000/report?from=2020-01-01T00:00:00Z&to=2021-01-01T00:00:00Z

### URL Parameters

    from = 2020-01-01T00:00:00Z
    to = 2021-01-01T00:00:00Z 

### Response

[
    {
        "total_amount": 200,
        "product_name": "product_02"
    },
    {
        "total_amount": 100,
        "product_name": "product_01"
    }
]